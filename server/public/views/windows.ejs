<!doctype html>
<html lang="fr" data-theme="ndi">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Windows 10 - Simulation | NDI 2025</title>
	<link rel="stylesheet" href="/stylesheets/style.css" />
	<script src="/javascripts/message-bus.js"></script>
	<script defer src="/javascripts/alpine.js"></script>
	<script src="/javascripts/windows-manager.js"></script>
	<style>
		[x-cloak] { display: none !important; }

		/* Window styles */
		.win-window {
			position: fixed;
			display: flex;
			flex-direction: column;
			background: white;
			border: 1px solid #374151;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
		}
		.win-window.maximized {
			top: 0 !important;
			left: 0 !important;
			width: calc(100% - 288px) !important;
			height: calc(100% - 56px) !important;
		}

		/* Resize handles */
		.resize-handle { position: absolute; z-index: 10; }
		.resize-handle.n { top: 0; left: 10px; right: 10px; height: 4px; cursor: n-resize; }
		.resize-handle.s { bottom: 0; left: 10px; right: 10px; height: 4px; cursor: s-resize; }
		.resize-handle.e { right: 0; top: 10px; bottom: 10px; width: 4px; cursor: e-resize; }
		.resize-handle.w { left: 0; top: 10px; bottom: 10px; width: 4px; cursor: w-resize; }
		.resize-handle.nw { top: 0; left: 0; width: 10px; height: 10px; cursor: nw-resize; }
		.resize-handle.ne { top: 0; right: 0; width: 10px; height: 10px; cursor: ne-resize; }
		.resize-handle.sw { bottom: 0; left: 0; width: 10px; height: 10px; cursor: sw-resize; }
		.resize-handle.se { bottom: 0; right: 0; width: 10px; height: 10px; cursor: se-resize; }
	</style>
</head>

<body class="h-screen overflow-hidden" x-data x-init="$store.wm.init('<%= basePath %>')">

	<!-- Desktop Background -->
	<div class="fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900">
		<div class="absolute inset-0 opacity-20">
			<div class="absolute top-10 left-10 w-96 h-96 bg-primary rounded-full blur-3xl opacity-30"></div>
			<div class="absolute bottom-20 right-10 w-96 h-96 bg-accent rounded-full blur-3xl opacity-30"></div>
		</div>
	</div>

	<!-- Desktop Icons (left side, excluding mission panel width) -->
	<div class="fixed inset-0 bottom-14 right-72 p-8 overflow-auto">
		<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
			<!-- Unlocked Apps -->
			<template x-for="app in $store.wm.availableApps" :key="app.id">
				<button
					@click="$store.wm.openApp(app)"
					class="flex flex-col items-center gap-2 p-4 rounded-lg hover:bg-white/10 active:scale-95 transition-all select-none"
				>
					<span class="text-5xl" x-text="app.icon"></span>
					<span class="text-white text-sm text-center bg-black/40 px-2 py-0.5 rounded" x-text="app.name"></span>
				</button>
			</template>

			<!-- Locked Apps -->
			<template x-for="app in $store.wm.apps.filter(a => !$store.wm.isAppUnlocked(a.id))" :key="'locked-' + app.id">
				<div class="flex flex-col items-center gap-2 p-4 rounded-lg opacity-40 cursor-not-allowed select-none">
					<span class="text-5xl grayscale" x-text="app.icon"></span>
					<span class="text-white text-sm text-center bg-black/40 px-2 py-0.5 rounded flex items-center gap-1">
						<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
						<span x-text="app.name"></span>
					</span>
				</div>
			</template>
		</div>
	</div>

	<!-- Mission Panel (Right Side) -->
	<div class="fixed right-0 top-0 bottom-14 w-72 bg-gray-900/95 backdrop-blur border-l border-gray-700 z-30 flex flex-col">
		<div class="p-4 border-b border-gray-700">
			<h2 class="text-white font-bold text-lg flex items-center gap-2">
				<span>üéØ</span> Missions
			</h2>
			<p class="text-white/60 text-sm mt-1">
				<span x-text="$store.wm.completedTasks.length"></span>/<span x-text="$store.wm.availableTasks.length"></span> completees
			</p>
		</div>

		<div class="flex-1 overflow-auto p-4 space-y-3">
			<template x-for="task in $store.wm.availableTasks" :key="task.id">
				<div
					:class="[
						'p-3 rounded-lg border transition-all',
						$store.wm.isTaskCompleted(task.id)
							? 'bg-green-900/30 border-green-500/50'
							: $store.wm.currentTask?.id === task.id
								? 'bg-primary/20 border-primary/50'
								: 'bg-gray-800/50 border-gray-700'
					]"
				>
					<div class="flex items-start gap-3">
						<div
							:class="[
								'w-6 h-6 rounded-full flex items-center justify-center text-sm shrink-0 mt-0.5',
								$store.wm.isTaskCompleted(task.id)
									? 'bg-green-500 text-white'
									: 'bg-gray-700 text-gray-400'
							]"
						>
							<template x-if="$store.wm.isTaskCompleted(task.id)">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
							</template>
							<template x-if="!$store.wm.isTaskCompleted(task.id)">
								<span>‚Ä¢</span>
							</template>
						</div>
						<div class="flex-1 min-w-0">
							<p
								:class="[
									'font-medium text-sm',
									$store.wm.isTaskCompleted(task.id) ? 'text-green-400 line-through' : 'text-white'
								]"
								x-text="task.title"
							></p>
							<p class="text-white/60 text-xs mt-1" x-text="task.description"></p>
						</div>
					</div>
				</div>
			</template>
		</div>

		<!-- Reset Button -->
		<div class="p-4 border-t border-gray-700">
			<button
				@click="if(confirm('Reinitialiser la progression ?')) $store.wm.resetProgress()"
				class="w-full btn btn-sm btn-ghost text-white/60 hover:text-white"
			>
				Reinitialiser
			</button>
		</div>
	</div>

	<!-- Windows -->
	<template x-for="win in $store.wm.windows" :key="win.id">
		<div
			x-show="!win.minimized"
			x-cloak
			@mousedown="$store.wm.focusWindow(win.id)"
			:class="['win-window', win.maximized && 'maximized']"
			:style="!win.maximized && `left:${win.x}px; top:${win.y}px; width:${win.width}px; height:${win.height}px; z-index:${win.zIndex}`"
		>
			<!-- Title Bar -->
			<div
				@mousedown="$store.wm.startDrag(win.id, $event)"
				class="flex items-center justify-between px-3 py-2 bg-gray-700 text-white cursor-move select-none shrink-0"
			>
				<div class="flex items-center gap-2">
					<span class="text-xl" x-text="win.app.icon"></span>
					<span class="text-sm font-medium" x-text="win.app.name"></span>
				</div>
				<div class="flex gap-1">
					<button @click.stop="$store.wm.minimizeWindow(win.id)" class="w-8 h-8 flex items-center justify-center hover:bg-white/20 transition-colors">
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M20 12H4"/></svg>
					</button>
					<button @click.stop="$store.wm.toggleMaximize(win.id)" class="w-8 h-8 flex items-center justify-center hover:bg-white/20 transition-colors">
						<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" stroke-width="2"/></svg>
					</button>
					<button @click.stop="$store.wm.closeWindow(win.id)" class="w-8 h-8 flex items-center justify-center hover:bg-red-500 transition-colors">
						<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
					</button>
				</div>
			</div>

			<!-- Content -->
			<div class="flex-1 overflow-auto bg-white">
				<iframe :src="win.app.url" class="w-full border-0" style="min-height: 100%; height: 800px;"></iframe>
			</div>

			<!-- Resize Handles -->
			<template x-if="!win.maximized">
				<div>
					<div class="resize-handle n" @mousedown.stop="$store.wm.startResize(win.id, $event, 'n')"></div>
					<div class="resize-handle s" @mousedown.stop="$store.wm.startResize(win.id, $event, 's')"></div>
					<div class="resize-handle e" @mousedown.stop="$store.wm.startResize(win.id, $event, 'e')"></div>
					<div class="resize-handle w" @mousedown.stop="$store.wm.startResize(win.id, $event, 'w')"></div>
					<div class="resize-handle nw" @mousedown.stop="$store.wm.startResize(win.id, $event, 'nw')"></div>
					<div class="resize-handle ne" @mousedown.stop="$store.wm.startResize(win.id, $event, 'ne')"></div>
					<div class="resize-handle sw" @mousedown.stop="$store.wm.startResize(win.id, $event, 'sw')"></div>
					<div class="resize-handle se" @mousedown.stop="$store.wm.startResize(win.id, $event, 'se')"></div>
				</div>
			</template>
		</div>
	</template>

	<!-- Search Overlay -->
	<div x-show="$store.wm.showSearch" x-cloak class="fixed inset-0 z-50 flex items-start justify-center pt-32">
		<div class="absolute inset-0 bg-black/50" @click="$store.wm.closeSearch()"></div>
		<div class="relative bg-base-100 rounded-lg shadow-2xl w-full max-w-xl mx-4 p-6" @click.stop>
			<div class="flex items-center gap-4 mb-4">
				<span class="text-3xl">üîç</span>
				<input
					type="text"
					x-model="$store.wm.searchQuery"
					@keydown.escape="$store.wm.closeSearch()"
					@keydown.enter="$store.wm.searchResults[0] && $store.wm.openApp($store.wm.searchResults[0])"
					placeholder="Rechercher une application..."
					class="input input-bordered w-full"
					autofocus
				/>
			</div>

			<div x-show="$store.wm.searchQuery" class="space-y-1">
				<template x-for="app in $store.wm.searchResults" :key="app.id">
					<button @click="$store.wm.openApp(app)" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-base-200 text-left">
						<span class="text-2xl" x-text="app.icon"></span>
						<div>
							<p class="font-medium" x-text="app.name"></p>
							<p class="text-sm opacity-60" x-text="app.category"></p>
						</div>
					</button>
				</template>
				<p x-show="$store.wm.searchResults.length === 0" class="text-center py-4 opacity-60">Aucun resultat</p>
			</div>

			<div x-show="!$store.wm.searchQuery" class="grid grid-cols-2 gap-2">
				<template x-for="app in $store.wm.availableApps" :key="app.id">
					<button @click="$store.wm.openApp(app)" class="flex items-center gap-3 p-3 rounded-lg hover:bg-base-200 text-left">
						<span class="text-xl" x-text="app.icon"></span>
						<span class="text-sm" x-text="app.name"></span>
					</button>
				</template>
			</div>
		</div>
	</div>

	<!-- Taskbar -->
	<div class="fixed bottom-0 left-0 right-0 h-14 bg-gray-800/95 backdrop-blur border-t border-gray-700 flex items-center px-2 gap-2 z-40">
		<button @click="$store.wm.toggleStartMenu()" class="w-12 h-12 flex items-center justify-center hover:bg-white/10 rounded transition-colors">
			<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
				<path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
			</svg>
		</button>

		<button @click="$store.wm.openSearch()" class="flex-1 max-w-md flex items-center gap-3 px-4 py-2 bg-white/10 hover:bg-white/20 rounded text-white/80 text-sm text-left transition-colors">
			<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
			</svg>
			<span>Rechercher</span>
		</button>

		<div class="flex items-center gap-1 mx-2">
			<template x-for="win in $store.wm.windows" :key="win.id">
				<button
					@click="$store.wm.onTaskbarClick(win.id)"
					:class="['flex items-center gap-2 px-3 py-2 rounded text-white text-sm transition-colors', win.minimized ? 'opacity-50' : 'bg-white/10']"
				>
					<span x-text="win.app.icon"></span>
					<span class="hidden sm:inline" x-text="win.app.name"></span>
				</button>
			</template>
		</div>

		<div class="ml-auto flex items-center gap-2 text-white">
			<button class="w-10 h-10 flex items-center justify-center hover:bg-white/10 rounded transition-colors">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.14 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"/>
				</svg>
			</button>
			<div
				x-data="{ time: '', date: '' }"
				x-init="setInterval(() => { time = new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}); date = new Date().toLocaleDateString('fr-FR', {day: 'numeric', month: 'short'}) }, 1000)"
				class="text-xs text-right px-2"
			>
				<div x-text="time"></div>
				<div class="opacity-70" x-text="date"></div>
			</div>
		</div>
	</div>

	<!-- Start Menu -->
	<div
		x-show="$store.wm.showStartMenu"
		x-cloak
		@click.away="$store.wm.showStartMenu = false"
		class="fixed bottom-16 left-2 w-72 bg-gray-800/95 backdrop-blur rounded-lg border border-gray-700 shadow-2xl z-50 p-4"
	>
		<div class="grid grid-cols-3 gap-2 mb-4">
			<template x-for="app in $store.wm.availableApps" :key="app.id">
				<button @click="$store.wm.openApp(app)" class="flex flex-col items-center gap-1 p-3 rounded-lg hover:bg-white/10 transition-colors">
					<span class="text-3xl" x-text="app.icon"></span>
					<span class="text-white text-xs text-center" x-text="app.name"></span>
				</button>
			</template>
		</div>
		<div class="border-t border-gray-600 pt-2">
			<button class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 text-white text-left transition-colors">
				<span class="text-xl">üîå</span>
				<span>Arreter</span>
			</button>
		</div>
	</div>

</body>
</html>
