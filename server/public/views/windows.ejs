<!doctype html>
<html lang="fr" data-theme="ndi">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Windows 10 - Simulation | NDI 2025</title>
	<link rel="stylesheet" href="<%= staticUrl('/stylesheets/style.css') %>" />
	<script src="<%= staticUrl('/javascripts/message-bus.js') %>"></script>
	<script defer src="<%= staticUrl('/javascripts/alpine.js') %>"></script>
	<script src="<%= staticUrl('/javascripts/windows-manager.js') %>"></script>
	<style>
		[x-cloak] { display: none !important; }
		body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

		/* Window styles */
		.win-window {
			position: fixed;
			display: flex;
			flex-direction: column;
			background: white;
			border: 1px solid #0078d7; /* Windows accent color border */
			box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
		}
		.win-window.maximized {
			top: 0 !important;
			left: 0 !important;
			width: 100% !important;
			height: calc(100% - 40px) !important; /* Minus taskbar height */
			border: none;
		}

		/* Title Bar Controls */
		.win-control {
			width: 46px;
			height: 30px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background-color 0.1s;
			font-size: 10px;
		}
		.win-control:hover { background-color: #e5e5e5; }
		.win-control.close:hover { background-color: #e81123; color: white; }

		/* Desktop Icons */
		.desktop-icon:hover {
			background-color: rgba(255, 255, 255, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
		}
		.desktop-icon:active {
			background-color: rgba(255, 255, 255, 0.2);
		}

		/* Resize handles */
		.resize-handle { position: absolute; z-index: 10; }
		.resize-handle.n { top: 0; left: 5px; right: 5px; height: 4px; cursor: n-resize; }
		.resize-handle.s { bottom: 0; left: 5px; right: 5px; height: 4px; cursor: s-resize; }
		.resize-handle.e { right: 0; top: 5px; bottom: 5px; width: 4px; cursor: e-resize; }
		.resize-handle.w { left: 0; top: 5px; bottom: 5px; width: 4px; cursor: w-resize; }
		.resize-handle.nw { top: 0; left: 0; width: 10px; height: 10px; cursor: nw-resize; }
		.resize-handle.ne { top: 0; right: 0; width: 10px; height: 10px; cursor: ne-resize; }
		.resize-handle.sw { bottom: 0; left: 0; width: 10px; height: 10px; cursor: sw-resize; }
		.resize-handle.se { bottom: 0; right: 0; width: 10px; height: 10px; cursor: se-resize; }
	</style>
</head>

<body class="h-screen overflow-hidden bg-cover bg-center" style="background-image: url('<%= staticUrl('/images/wallpaper.jpg') %>');" x-data x-init="$store.wm.init('<%= basePath %>')">

	<!-- Desktop Icons (left side, full width) -->
	<div class="fixed inset-0 bottom-10 p-2 overflow-auto pointer-events-none flex flex-col flex-wrap content-start gap-1">
		<div class="grid grid-flow-col grid-rows-[repeat(auto-fill,100px)] gap-2 pointer-events-auto w-fit h-full">
			<!-- Unlocked Apps -->
			<template x-for="app in $store.wm.availableApps" :key="app.id">
				<button
					@click="$store.wm.openApp(app)"
					class="desktop-icon w-[86px] h-[100px] flex flex-col items-center justify-start pt-2 gap-1 rounded-sm border border-transparent transition-all select-none group relative text-shadow"
				>
					<div class="relative">
						<!-- Notification Badge -->
						<div
							x-show="$store.wm.notifications.includes(app.id)"
							x-transition
							class="absolute top-0 right-0 w-5 h-5 bg-red-600 text-white text-[10px] flex items-center justify-center rounded-full shadow-md animate-bounce z-10"
						>!</div>

						<span class="text-4xl drop-shadow-xl block" x-text="app.icon"></span>
					</div>
					
					<span class="text-white text-xs text-center leading-tight drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]" x-text="app.name"></span>
				</button>
			</template>

			<!-- Locked Apps -->
			<template x-for="app in $store.wm.apps.filter(a => !$store.wm.isAppUnlocked(a.id))" :key="'locked-' + app.id">
				<div class="desktop-icon w-[86px] h-[100px] flex flex-col items-center justify-start pt-2 gap-1 rounded-sm border border-transparent opacity-50 cursor-not-allowed select-none grayscale">
					<span class="text-4xl drop-shadow-xl" x-text="app.icon"></span>
					<span class="text-white text-xs text-center leading-tight drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)] flex items-center gap-1">
						<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
						<span x-text="app.name"></span>
					</span>
				</div>
			</template>
		</div>
	</div>

	<!-- Windows -->
	<template x-for="win in $store.wm.windows" :key="win.id">
		<div
			:id="'window-' + win.id"
			x-show="!win.minimized"
			x-cloak
			@mousedown="$store.wm.focusWindow(win.id)"
			:class="['win-window', win.maximized && 'maximized']"
			:style="!win.maximized && `left:${win.x}px; top:${win.y}px; width:${win.width}px; height:${win.height}px; z-index:${win.zIndex}`"
		>
			<!-- Title Bar -->
			<div
				@mousedown="$store.wm.startDrag(win.id, $event)"
				class="flex items-center justify-between h-[30px] bg-white select-none shrink-0"
			>
				<div class="flex items-center gap-2 pl-3">
					<span class="text-sm" x-text="win.app.icon"></span>
					<span class="text-xs font-normal text-gray-700" x-text="win.app.name"></span>
				</div>
				<div class="flex h-full">
					<button @click.stop="$store.wm.minimizeWindow(win.id)" class="win-control" title="R√©duire">
						<svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="black"/></svg>
					</button>
					<button @click.stop="$store.wm.toggleMaximize(win.id)" class="win-control" title="Agrandir">
						<template x-if="!win.maximized">
							<svg width="10" height="10" viewBox="0 0 10 10"><rect width="10" height="10" stroke="black" stroke-width="1" fill="none"/></svg>
						</template>
						<template x-if="win.maximized">
							<svg width="10" height="10" viewBox="0 0 10 10">
								<rect x="2" y="0" width="8" height="8" stroke="black" stroke-width="1" fill="none"/>
								<rect x="0" y="2" width="8" height="8" fill="white"/>
								<rect x="0" y="2" width="8" height="8" stroke="black" stroke-width="1" fill="none"/>
							</svg>
						</template>
					</button>
					<button @click.stop="$store.wm.closeWindow(win.id)" class="win-control close" title="Fermer">
						<svg width="10" height="10" viewBox="0 0 10 10"><path d="M0,0 L10,10 M10,0 L0,10" stroke="currentColor" stroke-width="1"/></svg>
					</button>
				</div>
			</div>

			<!-- Content -->
			<div class="flex-1 overflow-auto bg-white relative">
				<iframe :src="win.app.url" class="w-full h-full border-0 absolute inset-0"></iframe>
			</div>

			<!-- Resize Handles -->
			<template x-if="!win.maximized">
				<div>
					<div class="resize-handle n" @mousedown.stop="$store.wm.startResize(win.id, $event, 'n')"></div>
					<div class="resize-handle s" @mousedown.stop="$store.wm.startResize(win.id, $event, 's')"></div>
					<div class="resize-handle e" @mousedown.stop="$store.wm.startResize(win.id, $event, 'e')"></div>
					<div class="resize-handle w" @mousedown.stop="$store.wm.startResize(win.id, $event, 'w')"></div>
					<div class="resize-handle nw" @mousedown.stop="$store.wm.startResize(win.id, $event, 'nw')"></div>
					<div class="resize-handle ne" @mousedown.stop="$store.wm.startResize(win.id, $event, 'ne')"></div>
					<div class="resize-handle sw" @mousedown.stop="$store.wm.startResize(win.id, $event, 'sw')"></div>
					<div class="resize-handle se" @mousedown.stop="$store.wm.startResize(win.id, $event, 'se')"></div>
				</div>
			</template>
		</div>
	</template>

	<!-- Start Menu -->
	<div
		x-show="$store.wm.showStartMenu"
		x-cloak
		@click.away="$store.wm.showStartMenu = false"
		class="fixed bottom-[40px] left-0 h-[500px] w-[640px] bg-[#1F1F1F]/95 backdrop-blur-md text-white flex shadow-2xl z-50 border border-[#333]"
		x-transition:enter="transition ease-out duration-100"
		x-transition:enter-start="transform translate-y-10 opacity-0"
		x-transition:enter-end="transform translate-y-0 opacity-100"
		x-transition:leave="transition ease-in duration-100"
		x-transition:leave-start="transform translate-y-0 opacity-100"
		x-transition:leave-end="transform translate-y-10 opacity-0"
	>
		<!-- Sidebar -->
		<div class="w-[48px] flex flex-col items-center justify-end pb-4 gap-4 bg-black/20">
			<button 
				@click="if(confirm('Reinitialiser la progression ?')) { $store.wm.resetProgress(); $store.wm.showStartMenu = false; }" 
				class="w-10 h-10 hover:bg-white/10 flex items-center justify-center" title="R√©initialiser"
			>
				<span class="text-lg">üîÑ</span>
			</button>
			<button class="w-10 h-10 hover:bg-white/10 flex items-center justify-center" title="Marche/Arr√™t">
				<span class="text-lg">‚èª</span>
			</button>
		</div>

		<!-- App List (Simplified as Tiles for now) -->
		<div class="flex-1 p-4 overflow-y-auto">
			<h3 class="text-xs font-semibold mb-4 pl-1">Applications</h3>
			<div class="grid grid-cols-4 gap-1">
				<template x-for="app in $store.wm.availableApps" :key="app.id">
					<button 
						@click="$store.wm.openApp(app)" 
						class="aspect-square bg-[#0078d7] hover:opacity-90 flex flex-col items-center justify-center p-2 gap-2 group transition-transform active:scale-95"
					>
						<span class="text-3xl" x-text="app.icon"></span>
						<span class="text-[10px] font-semibold text-center truncate w-full" x-text="app.name"></span>
					</button>
				</template>
			</div>
		</div>
	</div>

	<!-- Search Overlay -->
	<div x-show="$store.wm.showSearch" x-cloak class="fixed bottom-[40px] left-0 bg-[#1F1F1F] text-white w-[640px] h-[500px] shadow-2xl z-50 flex flex-col border border-[#333]">
		<div class="p-4">
			<h2 class="text-sm font-bold mb-4">Rechercher</h2>
			<input
				type="text"
				x-model="$store.wm.searchQuery"
				@keydown.escape="$store.wm.closeSearch()"
				@keydown.enter="$store.wm.searchResults[0] && $store.wm.openApp($store.wm.searchResults[0])"
				placeholder="Tapez ici pour rechercher..."
				class="w-full bg-white text-black p-2 border-b-2 border-[#0078d7] outline-none"
				autofocus
			/>
		</div>
		<div class="flex-1 overflow-y-auto p-4">
			<template x-for="app in $store.wm.searchResults" :key="app.id">
				<button @click="$store.wm.openApp(app)" class="w-full flex items-center gap-4 p-3 hover:bg-white/10 text-left">
					<span class="text-2xl" x-text="app.icon"></span>
					<div>
						<p class="font-medium text-sm" x-text="app.name"></p>
						<p class="text-xs opacity-60" x-text="app.category"></p>
					</div>
				</button>
			</template>
		</div>
	</div>

	<!-- Notification Center (Toasts) -->
	<div class="fixed bottom-[50px] right-0 z-50 flex flex-col gap-2 pointer-events-none p-4 items-end">
		<template x-for="notif in $store.wm.toasts" :key="notif.id">
			<div
				x-transition:enter="transition ease-out duration-300"
				x-transition:enter-start="transform translate-x-full opacity-0"
				x-transition:enter-end="transform translate-x-0 opacity-100"
				class="bg-[#1F1F1F] text-white w-80 shadow-2xl border border-[#333] pointer-events-auto flex cursor-default relative animate-slideInRight"
			>
				<div class="p-4 flex-1">
					<h4 class="font-bold text-sm mb-1" x-text="notif.title"></h4>
					<p class="text-xs text-gray-300 leading-snug" x-text="notif.message"></p>
				</div>
				<button @click="$store.wm.removeToast(notif.id)" class="absolute top-2 right-2 text-gray-400 hover:text-white">‚úï</button>
			</div>
		</template>
	</div>

	<!-- System Popups (Modal) -->
	<template x-for="popup in $store.wm.popups" :key="popup.id">
		<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm" x-cloak>
			<div 
				class="bg-white shadow-2xl border border-[#0078d7] w-full max-w-md mx-4 overflow-hidden flex flex-col max-h-[90vh] animate-scaleIn"
				@click.outside="$store.wm.removePopup(popup.id)"
			>
				<!-- Header -->
				<div class="bg-white border-b border-gray-200 px-4 py-2 flex justify-between items-center">
					<div class="flex items-center gap-2 text-sm font-semibold text-gray-800">
						<span x-text="popup.title"></span>
					</div>
					<button @click="$store.wm.removePopup(popup.id)" class="text-gray-500 hover:text-red-600 hover:bg-red-50 px-2 transition-colors">‚úï</button>
				</div>
				
				<!-- Content -->
				<div class="p-6 overflow-y-auto whitespace-pre-line text-sm text-gray-800 leading-relaxed bg-[#f0f0f0]" x-html="popup.content"></div>
				
				<!-- Footer -->
				<div class="bg-[#f0f0f0] px-4 py-3 flex justify-end gap-2 border-t border-gray-200">
					<button 
						@click="$store.wm.removePopup(popup.id)" 
						class="px-6 py-1 bg-[#e1e1e1] border border-[#adadad] hover:bg-[#e5f1fb] hover:border-[#0078d7] text-black text-sm transition-colors min-w-[80px]"
					>
						OK
					</button>
				</div>
			</div>
		</div>
	</template>

	<!-- Taskbar -->
	<div class="fixed bottom-0 left-0 right-0 h-[40px] bg-[#101010] flex items-center z-40 shadow-top text-white">
		<!-- Start Button -->
		<button @click="$store.wm.toggleStartMenu()" class="w-[48px] h-full flex items-center justify-center hover:bg-white/10 transition-colors group">
			<svg class="w-5 h-5 fill-white group-hover:fill-[#0078d7] transition-colors" viewBox="0 0 20 20">
				<path d="M0,2.8 L8.8,1.6 L8.8,9.6 L0,9.6 L0,2.8 Z M10,1.4 L20,0 L20,9.6 L10,9.6 L10,1.4 Z M0,10.8 L8.8,10.8 L8.8,17.6 L0,16.4 L0,10.8 Z M10,10.8 L20,10.8 L20,18.8 L10,17.2 L10,10.8 Z"/>
			</svg>
		</button>

		<!-- Search Box -->
		<div class="flex items-center h-full px-2">
			<button @click="$store.wm.openSearch()" class="bg-white text-gray-500 h-[30px] w-[250px] flex items-center px-3 text-xs hover:bg-[#e5e5e5] transition-colors">
				<span class="mr-2">üîç</span>
				<span>Tapez ici pour rechercher</span>
			</button>
		</div>

		<!-- Running Apps -->
		<div class="flex items-center h-full px-2 gap-1 flex-1">
			<template x-for="win in $store.wm.windows" :key="win.id">
				<button
					@click="$store.wm.onTaskbarClick(win.id)"
					:class="['h-full px-3 flex items-center gap-2 min-w-[140px] max-w-[200px] text-xs transition-colors border-b-2', win.minimized ? 'bg-transparent border-transparent hover:bg-white/10' : 'bg-white/10 border-[#0078d7] hover:bg-white/20']"
				>
					<span class="text-base" x-text="win.app.icon"></span>
					<span class="truncate" x-text="win.app.name"></span>
				</button>
			</template>
		</div>

		<!-- System Tray -->
		<div class="flex items-center h-full px-2 gap-2 text-xs">
			<div class="px-1 hover:bg-white/10 h-full flex items-center cursor-default">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z"/></svg>
			</div>
			<div class="px-1 hover:bg-white/10 h-full flex items-center cursor-default">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg>
			</div>
			<div
				x-data="{ time: '', date: '' }"
				x-init="setInterval(() => { const now = new Date(); time = now.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}); date = now.toLocaleDateString('fr-FR', {day: '2-digit', month: '2-digit', year: 'numeric'}) }, 1000)"
				class="text-right px-2 hover:bg-white/10 h-full flex flex-col justify-center cursor-default"
			>
				<div x-text="time"></div>
				<div x-text="date"></div>
			</div>
			<!-- Notification Bell -->
			<div class="w-[40px] h-full hover:bg-white/10 flex items-center justify-center cursor-default">
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/></svg>
			</div>
			<!-- Show Desktop Sliver -->
			<div class="w-[5px] h-full border-l border-gray-600 hover:bg-white/20"></div>
		</div>
	</div>

</body>
</html>
