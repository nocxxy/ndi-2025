<!doctype html>
<html lang="fr" data-theme="ndi">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Snake Game - NDI 2025</title>
		<link rel="stylesheet" href="<%= basePath %>/stylesheets/style.css" />
		<script defer src="<%= basePath %>/javascripts/alpine.js"></script>
	</head>

	<body class="min-h-screen bg-base-100">
		<%- include('partials/navbar', { basePath, page }) %>

		<!-- Hero -->
		<section class="hero min-h-[30vh] bg-gradient-to-br from-primary/20 via-accent/10 to-secondary/20 relative overflow-hidden">
			<div class="absolute inset-0 opacity-10">
				<div class="absolute top-10 left-10 w-72 h-72 bg-primary rounded-full blur-3xl"></div>
				<div class="absolute bottom-10 right-10 w-96 h-96 bg-accent rounded-full blur-3xl"></div>
				<div class="absolute top-1/2 left-1/2 w-80 h-80 bg-secondary rounded-full blur-3xl transform -translate-x-1/2 -translate-y-1/2"></div>
			</div>
			<div class="hero-content text-center relative z-10">
				<div class="max-w-4xl">
					<h1 class="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-primary via-accent to-secondary bg-clip-text text-transparent">
						üêç Snake Game
					</h1>
					<p class="text-2xl mb-4 font-semibold">
						Un jeu classique dans l'esprit NIRD
					</p>
					<p class="text-lg opacity-80">
						Utilisez les fl√®ches du clavier ou les boutons pour jouer
					</p>
				</div>
			</div>
		</section>

		<!-- Jeu Snake -->
		<section class="py-20 bg-gradient-to-br from-base-100 via-primary/5 to-base-100">
			<div class="container mx-auto px-4">
				<div class="max-w-4xl mx-auto">
					<div 
						x-data="{
							// √âtat du jeu
							gameStarted: false,
							gameOver: false,
							score: 0,
							highScore: 0,
							gridSize: 20,
							cellSize: 20,
							snake: [{x: 10, y: 10}],
							direction: {x: 1, y: 0},
							food: {x: 15, y: 15},
							gameLoop: null,
							rows: [],
							cells: [],
							
							init() {
								// G√©n√©rer les arrays pour la grille
								this.rows = Array.from({length: this.gridSize}, (_, i) => i);
								this.cells = Array.from({length: this.gridSize}, (_, i) => i);
								
								// Charger le meilleur score depuis localStorage
								if (typeof Storage !== 'undefined') {
									this.highScore = parseInt(localStorage.getItem('snakeHighScore') || '0');
								}
								
								// G√©rer les touches clavier
								this.keyHandler = (e) => {
									if (!this.gameStarted || this.gameOver) return;
									
									switch(e.key) {
										case 'ArrowUp':
											if (this.direction.y === 0) {
												this.direction = {x: 0, y: -1};
												e.preventDefault();
											}
											break;
										case 'ArrowDown':
											if (this.direction.y === 0) {
												this.direction = {x: 0, y: 1};
												e.preventDefault();
											}
											break;
										case 'ArrowLeft':
											if (this.direction.x === 0) {
												this.direction = {x: -1, y: 0};
												e.preventDefault();
											}
											break;
										case 'ArrowRight':
											if (this.direction.x === 0) {
												this.direction = {x: 1, y: 0};
												e.preventDefault();
											}
											break;
									}
								};
								
								window.addEventListener('keydown', this.keyHandler);
							},
							
							startGame() {
								this.gameStarted = true;
								this.gameOver = false;
								this.score = 0;
								this.snake = [{x: 10, y: 10}];
								this.direction = {x: 1, y: 0};
								this.generateFood();
								
								this.gameLoop = setInterval(() => {
									this.moveSnake();
								}, 150);
							},
							
							moveSnake() {
								const head = {
									x: this.snake[0].x + this.direction.x,
									y: this.snake[0].y + this.direction.y
								};
								
								// V√©rifier les collisions avec les murs
								if (head.x < 0 || head.x >= this.gridSize || head.y < 0 || head.y >= this.gridSize) {
									this.endGame();
									return;
								}
								
								// V√©rifier les collisions avec le corps
								if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
									this.endGame();
									return;
								}
								
								this.snake.unshift(head);
								
								// V√©rifier si on mange la nourriture
								if (head.x === this.food.x && head.y === this.food.y) {
									this.score += 10;
									this.generateFood();
									if (typeof Storage !== 'undefined' && this.score > this.highScore) {
										this.highScore = this.score;
										localStorage.setItem('snakeHighScore', this.highScore);
									}
								} else {
									this.snake.pop();
								}
							},
							
							generateFood() {
								do {
									this.food = {
										x: Math.floor(Math.random() * this.gridSize),
										y: Math.floor(Math.random() * this.gridSize)
									};
								} while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y));
							},
							
							endGame() {
								this.gameStarted = false;
								this.gameOver = true;
								if (this.gameLoop) {
									clearInterval(this.gameLoop);
									this.gameLoop = null;
								}
							},
							
							changeDirection(x, y) {
								if (!this.gameStarted || this.gameOver) return;
								if (this.direction.x === -x && this.direction.y === -y) return; // Emp√™cher de revenir en arri√®re
								this.direction = {x, y};
							},
							
							isSnakeHead(x, y) {
								return this.snake[0].x === x && this.snake[0].y === y;
							},
							
							isSnakeBody(x, y) {
								return this.snake.slice(1).some(segment => segment.x === x && segment.y === y);
							},
							
							isFood(x, y) {
								return this.food.x === x && this.food.y === y;
							}
						}"
						class="space-y-8"
					>
						<!-- Score et Contr√¥les -->
						<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
							<div class="card bg-gradient-to-br from-primary/20 to-primary/5 border-2 border-primary/30 shadow-2xl">
								<div class="card-body text-center p-6">
									<div class="text-3xl mb-2">üéØ</div>
									<div class="stat-value text-primary text-3xl" x-text="score"></div>
									<div class="stat-desc">Score actuel</div>
								</div>
							</div>
							
							<div class="card bg-gradient-to-br from-accent/20 to-accent/5 border-2 border-accent/30 shadow-2xl">
								<div class="card-body text-center p-6">
									<div class="text-3xl mb-2">üèÜ</div>
									<div class="stat-value text-accent text-3xl" x-text="highScore"></div>
									<div class="stat-desc">Meilleur score</div>
								</div>
							</div>
							
							<div class="card bg-gradient-to-br from-secondary/20 to-secondary/5 border-2 border-secondary/30 shadow-2xl">
								<div class="card-body text-center p-6">
									<div class="text-3xl mb-2">üìè</div>
									<div class="stat-value text-secondary text-3xl" x-text="snake.length"></div>
									<div class="stat-desc">Longueur</div>
								</div>
							</div>
						</div>

						<!-- Canvas du jeu -->
						<div class="card bg-gradient-to-br from-base-200 to-base-100 border-2 border-primary/20 shadow-2xl">
							<div class="card-body p-8">
								<div class="flex flex-col items-center gap-6">
									<!-- Grille du jeu -->
									<div 
										class="grid gap-0 bg-base-100 rounded-lg p-4 shadow-inner mx-auto"
										:style="`grid-template-columns: repeat(${gridSize}, ${cellSize}px); grid-template-rows: repeat(${gridSize}, ${cellSize}px);`"
									>
										<template x-for="y in rows" :key="'row-' + y">
											<template x-for="x in cells" :key="'cell-' + x + '-' + y">
												<div 
													class="border border-base-300"
													:class="{
														'bg-primary rounded-full': isSnakeHead(x, y),
														'bg-primary/70 rounded': isSnakeBody(x, y),
														'bg-accent rounded-full animate-pulse': isFood(x, y),
														'bg-base-200': !isSnakeHead(x, y) && !isSnakeBody(x, y) && !isFood(x, y)
													}"
												></div>
											</template>
										</template>
									</div>

									<!-- Message de fin de jeu -->
									<div 
										x-show="gameOver"
										x-transition
										class="alert alert-error shadow-xl border-2 border-error/30"
									>
										<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
										</svg>
										<div>
											<h3 class="font-bold text-lg">Game Over !</h3>
											<div class="text-sm">Score final : <span x-text="score" class="font-bold"></span></div>
										</div>
									</div>

									<!-- Bouton Start/Reset -->
									<button 
										@click="gameStarted ? endGame() : startGame()"
										class="btn btn-lg shadow-lg transform transition-all hover:scale-105"
										:class="gameStarted ? 'btn-error' : 'btn-primary'"
									>
										<span x-text="gameStarted ? 'Arr√™ter' : 'Commencer'"></span>
									</button>
								</div>
							</div>
						</div>

						<!-- Contr√¥les tactiles -->
						<div class="card bg-gradient-to-br from-base-200 to-base-100 border-2 border-secondary/20 shadow-2xl">
							<div class="card-body p-6">
								<h3 class="card-title text-center justify-center mb-4">Contr√¥les</h3>
								<div class="flex flex-col items-center gap-4">
									<!-- Fl√®che haut -->
									<button 
										@click="changeDirection(0, -1)"
										class="btn btn-secondary btn-circle shadow-lg transform transition-all hover:scale-110"
										:disabled="!gameStarted || gameOver"
									>
										<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
										</svg>
									</button>
									
									<!-- Fl√®ches gauche et droite -->
									<div class="flex gap-4">
										<button 
											@click="changeDirection(-1, 0)"
											class="btn btn-secondary btn-circle shadow-lg transform transition-all hover:scale-110"
											:disabled="!gameStarted || gameOver"
										>
											<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
											</svg>
										</button>
										
										<button 
											@click="changeDirection(1, 0)"
											class="btn btn-secondary btn-circle shadow-lg transform transition-all hover:scale-110"
											:disabled="!gameStarted || gameOver"
										>
											<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
											</svg>
										</button>
									</div>
									
									<!-- Fl√®che bas -->
									<button 
										@click="changeDirection(0, 1)"
										class="btn btn-secondary btn-circle shadow-lg transform transition-all hover:scale-110"
										:disabled="!gameStarted || gameOver"
									>
										<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
										</svg>
									</button>
								</div>
								
								<div class="divider"></div>
								
								<p class="text-center text-sm opacity-80">
									üí° Utilisez les fl√®ches du clavier ou les boutons ci-dessus pour contr√¥ler le serpent
								</p>
							</div>
						</div>

						<!-- Instructions -->
						<div class="card bg-gradient-to-br from-info/20 to-info/5 border-2 border-info/30 shadow-2xl">
							<div class="card-body p-6">
								<h3 class="card-title text-info mb-4">üìñ Comment jouer ?</h3>
								<div class="space-y-2 text-sm opacity-90">
									<p>‚Ä¢ Utilisez les fl√®ches du clavier ou les boutons pour diriger le serpent</p>
									<p>‚Ä¢ Mangez les pommes vertes pour grandir et gagner des points</p>
									<p>‚Ä¢ √âvitez de toucher les murs ou votre propre corps</p>
									<p>‚Ä¢ Votre meilleur score est sauvegard√© automatiquement</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<%- include('partials/footer', { basePath }) %>
	</body>
</html>

