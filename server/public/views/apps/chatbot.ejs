<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot</title>
    <link rel="stylesheet" href="<%= staticUrl('/stylesheets/style.css') %>">
    <script src="<%= staticUrl('/javascripts/message-bus.js') %>"></script>
    <script src="<%= staticUrl('/javascripts/chatbot-app.js') %>"></script>
    <script defer src="<%= staticUrl('/javascripts/alpine.js') %>"></script>
    <style>
        [x-cloak] { display: none !important; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden" x-data="chatbotApp">

    <!-- Header -->
    <div class="bg-white border-b px-4 py-3 flex items-center gap-3 shadow-sm">
        <div class="w-8 h-8 bg-gradient-to-tr from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white">
            âœ¨
        </div>
        <h1 class="font-bold text-gray-700">Copilot</h1>
    </div>

    <!-- Chat Area -->
    <div id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4">
        <template x-for="(msg, index) in messages" :key="index">
            <div :class="['flex', msg.role === 'user' ? 'justify-end' : 'justify-start']">
                <div 
                    :class="[
                        'max-w-[80%] p-3 rounded-2xl text-sm shadow-sm', 
                        msg.role === 'user' 
                            ? 'bg-blue-600 text-white rounded-br-none' 
                            : (msg.role === 'system' ? 'bg-gray-200 text-gray-600 text-center text-xs w-full max-w-full shadow-none' : 'bg-white text-gray-800 rounded-bl-none border border-gray-200')
                    ]"
                >
                    <p x-text="msg.content"></p>
                </div>
            </div>
        </template>

        <!-- Typing Indicator -->
        <div x-show="isTyping" class="flex justify-start" x-cloak>
            <div class="bg-white p-3 rounded-2xl rounded-bl-none border border-gray-200 shadow-sm flex items-center gap-1">
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
            </div>
        </div>
    </div>

    <!-- Input Area -->
    <div class="bg-white p-4 border-t">
        <div class="flex gap-2">
            <input 
                type="text" 
                x-model="userInput" 
                @keydown.enter="sendMessage()"
                placeholder="Posez une question..." 
                class="flex-1 input input-bordered input-sm focus:outline-none"
            >
            <button @click="sendMessage()" class="btn btn-sm btn-primary bg-blue-600 border-blue-600 hover:bg-blue-700 text-white">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
            </button>
        </div>
    </div>

</body>
</html>
